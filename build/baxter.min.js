(function(e,t){"use strict";function s(e,t){return Array.prototype.slice.call(e,t||0)}function o(e){var t=s(arguments,1);for(var n=0,r=t.length;n<r;n++){var i=t[n];for(var o in i)e[o]=i[o]}return e}function u(e,t){return function(){return t.apply(e,arguments)}}function a(e){return e.replace(/^\s+|\s+$/g,"")}function f(e){var t=s(arguments,1),n=["[",e.constructor.className],r=[],i,o;if(t.length>0){for(var u=0;u<t.length;u++)i=t[u],i instanceof Array?(o=i[1](e),i=i[0]):typeof e[i]=="string"?o="'"+e[i].replace(/'/g,"\\'")+"'":o=e[i],typeof o=="function"&&(o=o.apply(e)),r.push(i+": "+o);n.push(" "),n.push(r.join(", "))}return n.push("]"),n.join("")}function l(e){this.message=e,this.name="EOFError"}function c(e){this.message=e,this.name="ParseError"}function h(e){this.context=e}function p(e){if(typeof e!="string")throw new TypeError("Buffer expects a string");this.string=e,this.position=-1,this.line=0,this.column=0}function d(){this.tree=[]}function v(){}function m(e,t){this.id=e,this.content=t,this.ast=v.parse(t)}function g(){this.cache={}}var n,r="tt",i=e[r];o(l,{className:"EOFError"}),l.prototype=o(new Error,{constructor:l,toString:function(){return f(this,"message")}}),o(c,{className:"ParseError"}),c.prototype=o(new Error,{constructor:c,toString:function(){return f(this,"message")}}),o(h,{className:"Environment"}),o(h.prototype,{constructor:h,toString:function(){return f(this)},resolve:function(t){var n=t.split("."),r=this.context;try{for(var i=0;i<n.length;i++)r=r[n[i]]}catch(s){if(e.baxter.debug)throw s}return r}}),o(p,{className:"Buffer"}),o(p.prototype,{constructor:p,toString:function(){return f(this,"position","line","column")},eof:function(){return this.position>=this.string.length-1},peek:function(e){if(this.eof())throw new l;return this.string[this.position+(e||1)]},next:function(e){var t,n;e=e||1,t=[];while(e>0){if(this.eof())throw new l;this.position++,n=this.string[this.position],t.push(n),e--,n=="\n"||n=="\r"?(this.line++,this.column=0):this.column++}return t.join("")}}),o(d,{className:"AST"}),o(d.prototype,{constructor:d,toString:function(){return f(this,"length")},evaluate:function(e){return this.tree.map(function(t){return t.evaluate(e)}).join("")},length:function(){return this.tree.length},add:function(e){this.tree.push(e)},get:function(e){return this.tree[e]}}),d.Node=function(){},o(d.Node,{className:"AST.Node"}),o(d.Node.prototype,{constructor:d.Node,toString:function(){return f(this)},evaluate:function(e){return t}}),d.String=function(e,t,n){this.value=e,this.line=t,this.column=n},o(d.String,{className:"AST.String"}),d.String.prototype=o(new d.Node,{constructor:d.String,toString:function(){return f(this,"value","line","column")},evaluate:function(e){return this.value}}),d.Variable=function(e,t,n){this.name=e,this.line=t,this.column=n},o(d.Variable,{className:"AST.Variable"}),d.Variable.prototype=o(new d.Node,{constructor:d.Variable,toString:function(){return f(this,"name","line","column")},evaluate:function(e){return e.resolve(this.name)}}),o(v,{className:"Parser",instance:new v,parse:function(e){return this.instance.parse(e)}}),o(v.prototype,{constructor:v,toString:function(){return f(this)},parse:function(e){var t=new p(e),n=new d;while(!t.eof())this.parseNext(t,n);return n},parseNext:function(e,t){var n=e.peek();if(n=="{"){var r=e.peek(2);if(r=="{")this.parseVariable(e,t);else{if(r!="%")throw new c("Unknown statement syntax: '"+(n+r)+"' (line "+e.line+", column "+e.column);this.parseStatement(e,t)}}else this.parseString(e,t)},parseString:function(e,t){var n=e.line,r=e.column,i=[],s;try{while(e.peek()!="{")s=e.next(),s=="\\"?i.push(e.next()):i.push(s)}catch(o){if(!(o instanceof l))throw o}t.add(new d.String(i.join(""),n,r))},parseStatement:function(e,t){var n;e.next(2);while(e.peek()!="%")n=e.next();e.next(2)},parseVariable:function(e,t){var n=e.line,r=e.column,i,s=[];e.next(2);while(e.peek()!="}")i=e.next(),s.push(i);e.next(2),t.add(new d.Variable(a(s.join("")),n,r))}}),o(m,{className:"Template"}),o(m.prototype,{constructor:m,toString:function(){return f(this,"id","ast")},evaluate:function(e){return this.ast.evaluate(e)}}),o(g,{className:"Baxter"}),o(g.prototype,{constructor:g,toString:function(){return f(this)},clear:function(){this.cache={}},template:function(e,t){var n,r,i,s;if(typeof e!="string")throw new TypeError("Unknown template or template id: "+e);s=typeof t;if(s==="string")return this.register(e,t);if(s==="object"||s==="undefined")return this.evaluate(e,t||{});throw new TypeError("Unknown template or context: "+t)},register:function(e,t){this.cache[e]=new m(e,t)},evaluate:function(e,t){var n=this.get(e);return t instanceof Array?t.map(function(e){return n.evaluate(new h(e))}).join("\n"):n.evaluate(new h(t))},get:function(e){var t;return e in this.cache||(t=document.getElementById(e),t!==null?this.register(e,t.innerHTML):this.register(e,e)),this.cache[e]}}),n=new g,n.template=u(n,n.template),n.template.debug=!1,n.template.noConflict=function(){e[r]=i},e.baxter=n.template,e[r]=e.baxter})(this);