(function(e,t){"use strict";function r(e,t){return Array.prototype.slice.call(e,t||0)}function i(e){var t=r(arguments,1);for(var n=0,i=t.length;n<i;n++){var s=t[n];for(var o in s)e[o]=s[o]}return e}function s(e,t){return function(){return t.apply(e,arguments)}}function o(e){return e.replace(/^\s+|\s+$/g,"")}function u(e){this.message=e,this.name="EOFError"}function a(e){this.message=e,this.name="ParseError"}function f(e){this.context=e}function l(e){if(typeof e!="string")throw new TypeError("Buffer expects a string");this.string=e,this.position=-1}function c(){this.tree=[]}function h(){}function p(e,t){this.id=e,this.content=t,this.ast=h.parse(t)}function d(){this.cache={}}var n;u.prototype=i(new Error,{}),a.prototype=i(new Error,{}),i(f,{}),i(f.prototype,{resolve:function(t){var n=t.split("."),r=this.context;try{for(var i=0;i<n.length;i++)r=r[n[i]]}catch(s){if(e.baxter.debug)throw s}return r}}),i(l,{}),i(l.prototype,{eof:function(){return this.position>this.string.length},peek:function(e){if(this.eof())throw new u;return this.string[this.position+(e||1)]},next:function(e){var t;e=e||1,t=[];while(e>0){if(this.eof())throw new u;this.position++,t.push(this.string[this.position]),e--}return t.join("")}}),i(c,{}),i(c.prototype,{evaluate:function(e){return this.tree.map(function(t){return t.evaluate(e)}).join("")},add:function(e){this.tree.push(e)}}),c.Node=function(){},i(c.Node,{}),i(c.Node.prototype,{evaluate:function(e){return t}}),c.String=function(e){this.string=e},i(c.String,{}),c.String.prototype=i(new c.Node,{evaluate:function(e){return this.string}}),c.Variable=function(e){this.name=e},i(c.Variable,{}),c.Variable.prototype=i(new c.Node,{evaluate:function(e){return e.resolve(this.name)}}),i(h,{instance:new h,parse:function(e){return this.instance.parse(e)}}),i(h.prototype,{parse:function(e){var t=new l(e),n=new c;while(!t.eof())this.parseNext(t,n);return n},parseNext:function(e,t){var n=e.peek();if(n=="{"){var r=e.peek(2);if(r=="{")this.parseVariable(e,t);else{if(r!="%")throw new a("Unknown directive syntax: '"+(n+r)+"'");this.parseDirective(e,t)}}else this.parseString(e,t)},parseString:function(e,t){var n=[],r;try{while(e.peek()!="{")r=e.next(),r=="\\"?n.push(e.next()):n.push(r)}catch(i){if(!(i instanceof u))throw i}t.add(new c.String(n.join("")))},parseDirective:function(e,t){var n;e.next(2);while(e.peek()!="%")n=e.next();e.next(2)},parseVariable:function(e,t){var n,r=[];e.next(2);while(e.peek()!="}")n=e.next(),r.push(n);e.next(2),t.add(new c.Variable(o(r.join(""))))}}),i(p,{}),i(p.prototype,{evaluate:function(e){return this.ast.evaluate(e)}}),i(d,{}),i(d.prototype,{clear:function(){this.cache={}},template:function(e,t){var n,r,i,s;if(typeof e!="string")throw new TypeError("Unknown template or template id: "+e);s=typeof t;if(s==="string")return this.register(e,t);if(s==="object"||s==="undefined")return this.evaluate(e,t||{});throw new TypeError("Unknown template or context: "+t)},register:function(e,t){this.cache[e]=new p(e,t)},evaluate:function(e,t){var n=this.get(e);return t instanceof Array?t.map(function(e){return n.evaluate(new f(e))}).join("\n"):n.evaluate(new f(t))},get:function(e){return e in this.cache||this.register(e,e),this.cache[e]}}),n=new d,n.template=s(n,n.template),n.template.debug=!1,e.baxter=n.template})(this);